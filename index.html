import React, { useState } from 'react';
import { motion } from 'framer-motion';

const SaudiVirtualJourney = () => {
  const [currentDestination, setCurrentDestination] = useState(0);
  const [gameStarted, setGameStarted] = useState(false);
  const [gameCompleted, setGameCompleted] = useState(false);
  const [showHomepage, setShowHomepage] = useState(true);
  const [userAnswers, setUser Answers] = useState<{[key: number]: string}>({});
  const [showAnswerFeedback, setShowAnswerFeedback] = useState(false);
  const [isAnswerCorrect, setIsAnswerCorrect] = useState(false);
  const [selectedAnswer, setSelectedAnswer] = useState('');
  const [language, setLanguage] = useState<'ar' | 'en'>('ar');

  const destinations = [
    {
      id: 1,
      name: { ar: 'مكة المكرمة', en: 'Makkah' },
      description: {
        ar: 'مكة المكرمة قبلة المسلمين وأقدس بقاع الأرض.',
        en: 'Makkah, the direction of prayer for Muslims and the holiest place on Earth.'
      },
      question: {
        ar: 'في أي سنة وُحدت المملكة؟',
        en: 'In which year was the Kingdom unified?'
      },
      options: {
        ar: ['1920', '1932', '1950', '1971'],
        en: ['1920', '1932', '1950', '1971']
      },
      correctAnswer: '1932',
      image: 'https://upload.wikimedia.org/wikipedia/commons/9/9e/Masjid_al-Haram_in_Makkah_2010.jpg'
    },
    {
      id: 2,
      name: { ar: 'العلا', en: 'AlUla' },
      description: {
        ar: 'العلا مدينة التاريخ والحضارة القديمة.',
        en: 'AlUla, the city of history and ancient civilization.'
      },
      question: {
        ar: 'إلى أي حضارة تعود مدائن صالح؟',
        en: 'Which civilization does Madain Saleh belong to?'
      },
      options: {
        ar: ['الفراعنة', 'الأنباط', 'الرومان', 'الساسانيين'],
        en: ['Pharaohs', 'Nabateans', 'Romans', 'Sassanids']
      },
      correctAnswer: 'الأنباط',
      image: 'https://upload.wikimedia.org/wikipedia/commons/3/3a/Mada%27in_Salih_01.jpg'
    },
    {
      id: 3,
      name: { ar: 'الرياض', en: 'Riyadh' },
      description: {
        ar: 'العاصمة الحديثة والمركز المالي والتجاري.',
        en: 'The modern capital and financial and commercial center.'
      },
      question: {
        ar: 'ما اسم البرج الأشهر في الرياض؟',
        en: 'What is the name of the most famous tower in Riyadh?'
      },
      options: {
        ar: ['برج الفيصلية', 'برج المملكة', 'برج رافال', 'برج المياه'],
        en: ['Faisaliah Tower', 'Kingdom Tower', 'Rafal Tower', 'Water Tower']
      },
      correctAnswer: 'برج المملكة',
      image: 'https://upload.wikimedia.org/wikipedia/commons/7/7a/Kingdom_Centre_Tower_in_Riyadh.jpg'
    },
    {
      id: 4,
      name: { ar: 'نيوم', en: 'NEOM' },
      description: {
        ar: 'نيوم مدينة المستقبل والطاقة المتجددة.',
        en: 'NEOM, the city of the future and renewable energy.'
      },
      question: {
        ar: 'ما أحد مشاريع رؤية 2030 العملاقة؟',
        en: 'What is one of the giant projects of Vision 2030?'
      },
      options: {
        ar: ['القدية', 'البحر الأحمر', 'نيوم', 'كل ما سبق'],
        en: ['Qiddiya', 'Red Sea', 'NEOM', 'All of the above']
      },
      correctAnswer: 'نيوم',
      image: 'https://upload.wikimedia.org/wikipedia/commons/1/1a/NEOM_Logo.png' // NEOM logo as placeholder
    }
  ];

  const toggleLanguage = () => {
    setLanguage(language === 'ar' ? 'en' : 'ar');
  };

  const handleStartGame = () => {
    setShowHomepage(false);
    setGameStarted(true);
  };

  const handleAnswerSelect = (answer: string) => {
    setSelectedAnswer(answer);
  };

  const handleAnswerSubmit = () => {
    if (!selectedAnswer) return;
    const currentDest = destinations[currentDestination];
    const isCorrect = selectedAnswer.trim().toLowerCase() === currentDest.correctAnswer.toLowerCase();
    setIsAnswerCorrect(isCorrect);
    setShowAnswerFeedback(true);
    setUser Answers(prev => ({ ...prev, [currentDestination]: selectedAnswer }));
    if (isCorrect) {
      setTimeout(() => {
        setShowAnswerFeedback(false);
        setSelectedAnswer('');
        if (currentDestination < destinations.length - 1) {
          setCurrentDestination(prev => prev + 1);
        } else {
          setGameCompleted(true);
        }
      }, 2000);
    }
  };

  const handleRetry = () => {
    setShowAnswerFeedback(false);
    setSelectedAnswer('');
  };

  const handleRestartGame = () => {
    setCurrentDestination(0);
    setGameStarted(false);
    setGameCompleted(false);
    setShowHomepage(true);
    setUser Answers({});
    setShowAnswerFeedback(false);
    setSelectedAnswer('');
  };

  if (showHomepage) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-green-900 via-[#006C35] to-emerald-800 p-6 text-center" dir={language === 'ar' ? 'rtl' : 'ltr'}>
        <button onClick={toggleLanguage} className="absolute top-4 right-4 bg-white/20 rounded px-3 py-1 text-[#CFAE62] hover:text-white transition">{language === 'ar' ? 'EN' : 'AR'}</button>
        <h1 className="text-5xl font-bold mb-6" style={{ color: '#CFAE62', fontFamily: language === 'ar' ? 'Cairo, sans-serif' : 'Poppins, sans-serif' }}>
          {language === 'ar' ? 'المملكة العربية السعودية' : 'Kingdom of Saudi Arabia'}
        </h1>
        <p className="text-white max-w-3xl mx-auto mb-12 text-lg leading-relaxed">
          {language === 'ar'
            ? 'أرض التاريخ العريق والمستقبل المشرق. استكشف ثقافتنا الغنية وتراثنا العظيم ورؤيتنا الطموحة 2030.'
            : 'Land of ancient history and bright future. Explore our rich culture, great heritage, and ambitious Vision 2030.'}
        </p>
        <button
          onClick={handleStartGame}
          className="bg-[#006C35] hover:bg-[#005a2a] text-white font-bold py-4 px-8 rounded-full text-lg transition duration-300 shadow-lg"
        >
          {language === 'ar' ? 'اختبر معلوماتك' : 'Test Your Knowledge'}
        </button>
      </div>
    );
  }

  if (gameCompleted) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-[#006C35] to-[#0099CC] flex flex-col items-center justify-center p-6 text-center" dir={language === 'ar' ? 'rtl' : 'ltr'}>
        <h2 className="text-4xl font-bold mb-4" style={{ color: '#CFAE62', fontFamily: language === 'ar' ? 'Cairo, sans-serif' : 'Poppins, sans-serif' }}>
          {language === 'ar' ? 'مبروك!' : 'Congratulations!'}
        </h2>
        <p className="text-white text-xl mb-8 max-w-xl">
          {language === 'ar'
            ? 'أنهيت رحلتك في المملكة العربية السعودية 🌟 أنت الآن مستكشف حقيقي!'
            : 'You completed your journey in Saudi Arabia 🌟 You are now a true explorer!'}
        </p>
        <button
          onClick={handleRestartGame}
          className="bg-[#006C35] hover:bg-[#005a2a] text-white font-bold py-3 px-8 rounded-full mb-4 transition duration-300 shadow-lg"
        >
          {language === 'ar' ? 'إعادة الرحلة' : 'Restart Journey'}
        </button>
      </div>
    );
  }

  const currentDest = destinations[currentDestination];

  return (
    <div className="min-h-screen bg-gradient-to-br from-green-900 to-emerald-800 relative p-6 text-center" dir={language === 'ar' ? 'rtl' : 'ltr'}>
      <button onClick={toggleLanguage} className="absolute top-4 right-4 bg-white/20 rounded px-3 py-1 text-[#CFAE62] hover:text-white transition">{language === 'ar' ? 'EN' : 'AR'}</button>
      <h2 className="text-3xl font-bold mb-4" style={{ color: '#CFAE62', fontFamily: language === 'ar' ? 'Cairo, sans-serif' : 'Poppins, sans-serif' }}>
        {currentDest.name[language]}
      </h2>
      <img
        src={currentDest.image}
        alt={currentDest.name[language]}
        className="mx-auto rounded-lg shadow-lg mb-6 max-h-64 object-cover"
      />
      <p className="text-white mb-6 max-w-xl mx-auto">{currentDest.description[language]}</p>

      {!showAnswerFeedback ? (
        <>
          <p className="text-white text-lg mb-4 font-semibold">{currentDest.question[language]}</p>
          <div className="max-w-xl mx-auto grid grid-cols-1 gap-4">
            {currentDest.options[language].map((option, idx) => (
              <button
                key={idx}
                onClick={() => setSelectedAnswer(option)}
                className={`py-3 rounded-lg border-2 font-semibold transition ${
                  selectedAnswer === option
                    ? 'bg-[#CFAE62] border-[#CFAE62] text-white'
                    : 'bg-white/10 border-white/30 text-white hover:border-[#CFAE62]'
                }`}
              >
                {option}
              </button>
            ))}
          </div>
          <button
            onClick={handleAnswerSubmit}
            disabled={!selectedAnswer}
            className={`mt-6 py-3 px-8 rounded-full font-bold transition duration-300 ${
              selectedAnswer
                ? 'bg-[#006C35] hover:bg-[#005a2a] text-white cursor-pointer'
                : 'bg-gray-500 text-gray-300 cursor-not-allowed'
            }`}
          >
            {language === 'ar' ? 'تأكيد الإجابة' : 'Confirm Answer'}
          </button>
        </>
      ) : (
        <div className="mt-6 p-6 rounded-lg bg-white/10 border border-[#CFAE62] max-w-xl mx-auto">
          <p className={`text-2xl font-bold mb-4 ${isAnswerCorrect ? 'text-green-400' : 'text-red-400'}`}>
            {isAnswerCorrect ? (language === 'ar' ? 'إجابة صحيحة! ✓' : 'Correct Answer! ✓') : (language === 'ar' ? 'إجابة خاطئة! ✗' : 'Incorrect Answer! ✗')}
          </p>
          {!isAnswerCorrect && (
            <p className="text-white mb-4">
              {language === 'ar' ? 'الإجابة الصحيحة: ' : 'Correct answer: '}
              {currentDest.correctAnswer}
            </p>
          )}
          {!isAnswerCorrect && (
            <button
              onClick={handleRetry}
              className="bg-[#0099CC] hover:bg-[#0088bb] text-white font-bold py-2 px-6 rounded-full transition duration-300"
            >
              {language === 'ar' ? 'حاول مرة أخرى' : 'Try Again'}
            </button>
          )}
        </div>
      )}
    </div>
  );
};

export default SaudiVirtualJourney;
